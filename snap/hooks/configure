#!/bin/sh
set -x -e
exec 1>$SNAP_DATA/hook-log.out 2>&1

# Get the parameters from the snap settings
interface=$(snapctl get interface)
listenon=$(snapctl get listenon)
proxy=$(snapctl get proxy)
nm=$(snapctl get nm)

if [ -z "$proxy" ]; then
  proxy="false"
fi
if [ -z "$nm" ]; then
  nm="false"
fi

# Store the settings
cd $SNAP
if [ -z "$interface" ]; then
  bin/device-config -configure -proxy="$proxy" -nm="$nm" -listenon="$listenon"
else
  bin/device-config -configure -proxy="$proxy" -nm="$nm" -listenon="$listenon" -interface="$interface"
fi

# Restart the service
snapctl restart "${SNAP_NAME}".run
